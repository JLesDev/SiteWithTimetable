<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="description" content="Professional Rust Developer and Amateur Journalist" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <title>Jonty Leslie - Programming Professional</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">

    <link rel="canonical" href="https://jlesdev.github.io/SiteWithTimetable/">
    <meta property="og:title" content="Jonty Leslie - Programming Professional">
    <meta property="og:description" content="Professional Rust Developer and Amateur Journalist">
    <meta property="og:image" content="https://media.licdn.com/dms/image/v2/D5603AQEC83LqIlaY2g/profile-displayphoto-shrink_800_800/profile-displayphoto-shrink_800_800/0/1682736156495?e=1772668800&v=beta&t=mTGRSkSpTmN4iZ6dFhdc3C0wPC5ipaGxKken-l8QJVU">
    <meta property="og:url" content="https://jlesdev.github.io/SiteWithTimetable/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

    <header>
        <div class="container" id="header-container">
            <h2>Jonty Leslie - Rust Developer</h2>
            <nav>
                <a href="index.html" class="active">Home</a>
                <a class="butt" href="resume.html">Résumé</a>
                <a class="butt" href="contact.html">Blog</a>
                <a class="butt" href="about.html">About</a>
            </nav>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <div>
                <h1>Jonty Leslie</h1>
                <p>Professional Rust Developer.</p>
                <p>Amateur journalist.</p>
                <p><strong>Need a hand with your Rust? Contact me.</strong></p>
                <p><strong>This site was developed on Wurundjeri land.</strong></p>
            </div>

            <div class="quote-box">
                <span class="highlight-container">
                    <h3><span class="highlight">Send me a message</span></h3>
                </span>

                <form action="https://formsubmit.co/jontyleslie@gmail.com" method="POST">
                    <input type="text" name="name" placeholder="Name*" required>
                    <input type="email" name="email" placeholder="Email*" required>
                    <input type="text" name="phone" placeholder="Message" required>

                    <input type="hidden" name="_subject" value="New Quote Request">
                    <input type="hidden" name="_captcha" value="false">

                    <button type="submit">Send into the abyss</button>
                </form>
            </div>
        </div>

    </section>

   <section class="tracker">
    <h2>City Loop Live Tracker</h2>

    <div class="tracker-controls">
        <button data-sort="time" class="active">Upcoming</button>
        <button data-sort="station">City Loop</button>
        <button data-sort="all-stations">All Stations</button>
        <button data-sort="search">Search</button>
    </div>

    <div id="search-container" style="display:none; margin:15px 0;">
        <input type="text" id="station-search" placeholder="Search station name..."
            style="padding:10px; width:100%; max-width:400px;">
    </div>

    <div id="train-board">Loading trains…</div>
</section>


    <section class="services">
        <h2>My Projects</h2>

        <div class="service-grid">

            <div class="service" style="background-size: cover; background-color:#02343F;color:#F0EDCC;">
                <h3>Jeather 2</h3>
                <p>The world's first social media for weather.</p>
            </div>

            <div class="service" style="background-size: cover; background-color:#02343F;color:#F0EDCC;">
                <h3>Card Tennis</h3>
                <p>Cards have been the same for 300 years... until now.</p>
            </div>

            <div class="service" style="background-size: cover; background-color:#02343F;color:#F0EDCC;">
                <h3>Not Wordle</h3>
                <p>It's a rust based wordle... with a twist.</p>
            </div>

            <div class="service" style="background-size: cover;background-color:#02343F;color:#F0EDCC;">
                <h3>Open Source Contributions</h3>
                <p>Mikoto, tiberius, and more.</p>
            </div>

        </div>

    </section>

    <footer>
        <p>Jonty, 2026, Designed with care and vanilla JS</p>
        <p>Melbourne, Wurundjeri land | 0466 832 387</p>
    </footer>

    <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "LocalBusiness",
          "name": "Vortex Gutter Cleaning",
          "telephone": "0466 832 387",
          "address": {
            "@type": "PostalAddress",
            "streetAddress": "Kensington VIC",
            "addressLocality": "Melbourne",
            "addressRegion": "VIC",
            "postalCode": "3000",
            "addressCountry": "AU"
          },
          "url": "https://jlesdev.github.io/VortexGutters/",
          "description": "Professional gutter, downpipe and roof cleaning services in Melbourne and surrounding suburbs."
        }
    </script>

    <script>
    const FLINDERS_STOP_ID = 1071;

    let searchQuery = "";
    let allStations = {};
    let allStationDepartures = {};

    const STOPS = {
        flinders: 1071,
        parliament: 1155,
        melbourneCentral: 1120,
        flagstaff: 1068,
        southernCross: 1181
    };

    const STATION_NAMES = {
        1071: 'Flinders Street',
        1155: 'Parliament',
        1120: 'Melbourne Central',
        1068: 'Flagstaff',
        1181: 'Southern Cross'
    };

    const LINES = {
        1: 'Alamein',
        2: 'Belgrave',
        3: 'Craigieburn',
        4: 'Cranbourne',
        5: 'Flemington Racecourse',
        6: 'Frankston',
        7: 'Glen Waverley',
        8: 'Hurstbridge',
        9: 'Lilydale',
        10: 'Mernda',
        11: 'Pakenham',
        12: 'Sandringham',
        13: 'Stony Point',
        14: 'Sunbury',
        15: 'Upfield',
        16: 'Werribee',
        17: 'Williamstown',
    }

    const LINE_COLOURS = {
        'Alamein': "#A6E3FF",
        'Belgrave': "#A6E3FF",
        'Craigieburn': "#F5EC5D",
        'Cranbourne': "#73EBE3",
        'Flemington Racecourse': "#F5EC5D",
        'Frankston': "#6BE35F",
        'Glen Waverley': "#A6E3FF",
        'Hurstbridge': "#EB8373",
        'Lilydale': "#A6E3FF",
        'Mernda': "#EB8373",
        'Pakenham': "#73EBE3",
        'Sandringham': "#F55DEB",
        'Stony Point': "#6BE35F",
        'Sunbury': "#F5EC5D",
        'Upfield': "#F5EC5D",
        'Werribee': "#F55DEB",
        'Williamstown': "#F55DEB",
    }

    const LOOP_POSITIONS = {
        "Flagstaff": [1, 1],
        "Melbourne Central": [1, 2],
        "Parliament": [2, 3],
        "Flinders Street": [3, 2],
        "Southern Cross": [2, 1],
    };

    let sortMode = "time";
    let cachedResults = [];

    async function loadAllStations() {
        try {
            const res = await fetch("https://ptv.jontyleslie.workers.dev/stations");
            const data = await res.json();

            if (data.stations && Array.isArray(data.stations)) {
                data.stations.forEach(station => {
                    allStations[station.stop_id] = station.stop_name;
                });
                console.log("Loaded", Object.keys(allStations).length, "stations");
            }
        } catch (err) {
            console.error("Failed to load stations:", err);
        }
    }

    loadAllStations();

    document.addEventListener("click", e => {
        if (!e.target.dataset.sort) return;

        document
            .querySelectorAll(".tracker-controls button")
            .forEach(b => b.classList.remove("active"));

        e.target.classList.add("active");
        sortMode = e.target.dataset.sort;

        const searchBox = document.getElementById("search-container");

        if (sortMode === "search") {
            searchBox.style.display = "block";
        } else {
            searchBox.style.display = "none";
            searchQuery = "";
            document.getElementById("station-search").value = "";
        }

        renderBoard();
    });

    document.addEventListener("input", e => {
        if (e.target.id === "station-search") {
            searchQuery = e.target.value.toLowerCase();
            renderBoard();
        }
    });

    async function loadTrains() {
        const board = document.getElementById("train-board");
        
        // Don't show loading if we're in all-stations mode (it updates in background)
        if (sortMode !== "all-stations") {
            board.innerHTML = "Loading trains…";
        }

        try {
            const results = [];

            for (let key in STOPS) {
                const stopId = STOPS[key];

                const res = await fetch(`https://ptv.jontyleslie.workers.dev/?stop=${stopId}`);
                const data = await res.json();

                if (!data.departures) continue;

                data.departures.slice(0, 3).forEach(dep => {
                    const time =
                        dep.estimated_departure_utc ||
                        dep.scheduled_departure_utc;

                    if (!time) return;

                    const diff = new Date(time).getTime() - Date.now();
                    const mins = Math.ceil(diff / 60000);

                    if (!Number.isFinite(mins) || mins < 0) return;

                    const route =
                        data.routes?.[dep.route_id]?.route_short_name ||
                        data.routes?.[dep.route_id]?.route_name ||
                        "";

                    const direction =
                        data.directions?.[dep.direction_id]?.direction_name || "";

                    const run = data.runs?.[dep.run_id]?.run_name || "";
                    const route_id = dep.route_id;
                    const platform = dep.platform_number;
                    const line_name = LINES[route_id] || route_id;
                    const label = route || run || direction || "Train";

                    results.push({
                        station: STATION_NAMES[stopId] || key.replace(/([A-Z])/g, " $1"),
                        line: label,
                        destination: line_name,
                        platform,
                        mins
                    });
                });
            }

            cachedResults = results;
            renderBoard();

        } catch (err) {
            if (sortMode !== "all-stations") {
                board.innerHTML = "Tracker offline.";
            }
            console.error(err);
        }
    }

    loadTrains();
    setInterval(loadTrains, 30000);

    function renderLoop(board) {
        const grouped = {};

        cachedResults.forEach(t => {
            if (!grouped[t.station]) grouped[t.station] = [];
            grouped[t.station].push(t);
        });

        Object.entries(LOOP_POSITIONS).forEach(([station, pos]) => {
            const cell = document.createElement("div");
            cell.className = "loop-station";
            cell.style.gridRow = pos[0];
            cell.style.gridColumn = pos[1];

            cell.innerHTML = `<div class="loop-title">${station}</div>`;

            (grouped[station] || []).slice(0, 3).forEach(t => {
                const row = document.createElement("div");
                row.className = "loop-train";

                row.innerHTML = `
                <span style="color:${LINE_COLOURS[t.destination] || "#fff"}">
                  ${t.destination}
                </span>
                <span>${t.mins}m</span>
            `;

                cell.appendChild(row);
            });

            board.appendChild(cell);
        });
    }

    async function renderAllStationsGrid(board) {
        board.innerHTML = "<div style='padding: 20px; text-align: center;'>Loading all stations... This may take a moment.</div>";
        
        const majorStations = Object.entries(allStations)
            .filter(([id, name]) => {

                return true; 
            })
            .slice(0, 20);

        board.innerHTML = "";
        board.classList.add("all-stations-grid");

        for (let [stopId, stationName] of majorStations) {
            const cell = document.createElement("div");
            cell.className = "station-cell";
            cell.innerHTML = `
                <div class="station-cell-title">${stationName}</div>
                <div class="station-cell-loading">Loading...</div>
            `;
            board.appendChild(cell);

            loadStationDeparturesForGrid(stopId, cell);
        }
    }

    async function loadStationDeparturesForGrid(stopId, cellElement) {
        try {
            const res = await fetch(`https://ptv.jontyleslie.workers.dev/?stop=${stopId}`);
            const data = await res.json();

            const loadingDiv = cellElement.querySelector('.station-cell-loading');
            
            if (!data.departures || data.departures.length === 0) {
                loadingDiv.textContent = "No departures";
                loadingDiv.style.opacity = "0.5";
                return;
            }

            loadingDiv.remove();

            data.departures.slice(0, 3).forEach(dep => {
                const time = dep.estimated_departure_utc || dep.scheduled_departure_utc;
                if (!time) return;

                const diff = new Date(time).getTime() - Date.now();
                const mins = Math.ceil(diff / 60000);

                if (!Number.isFinite(mins) || mins < 0) return;

                const route_id = dep.route_id;
                const line_name = LINES[route_id] || route_id;
                let direction_id = dep.direction_id || "";

                if (direction_id == 1) {
                    direction_id = "From ";
                }
                else {
                    direction_id = "To ";
                }

                const trainDiv = document.createElement("div");
                trainDiv.className = "station-cell-train";
                trainDiv.innerHTML = `
                    <span style="color:${LINE_COLOURS[line_name] || "#fff"}">${direction_id}${line_name}</span>
                    <span>${mins}m</span>
                `;
                cellElement.appendChild(trainDiv);
            });

        } catch (err) {
            const loadingDiv = cellElement.querySelector('.station-cell-loading');
            if (loadingDiv) {
                loadingDiv.textContent = "Error";
                loadingDiv.style.color = "#ff6b6b";
            }
            console.error(`Error loading departures for station ${stopId}:`, err);
        }
    }

    function renderBoard() {
        const board = document.getElementById("train-board");
        board.innerHTML = "";
        board.classList.remove("loop", "all-stations-grid");

        if (sortMode === "station") {
            board.classList.add("loop");
            renderLoop(board);
            return;
        }

        if (sortMode === "all-stations") {
            renderAllStationsGrid(board);
            return;
        }

        let sorted = [...cachedResults];

        if (sortMode === "time") {
            sorted.sort((a, b) => a.mins - b.mins);
        }

        if (sortMode === "search") {
            const matchingStations = Object.entries(allStations)
                .filter(([id, name]) => name.toLowerCase().includes(searchQuery))
                .map(([id]) => parseInt(id));

            if (matchingStations.length === 0 && searchQuery) {
                board.innerHTML = "No matching station found.";
                return;
            }

            if (matchingStations.length > 0 && searchQuery) {
                board.innerHTML = `
                <div class="search-results">
                    <h3>Found ${matchingStations.length} matching station(s):</h3>
                    <div class="station-list">
                        ${matchingStations.slice(0, 10).map(stopId => `
                            <button class="station-button" data-stop-id="${stopId}">
                                ${allStations[stopId]}
                            </button>
                        `).join('')}
                    </div>
                    ${matchingStations.length > 10 ? `<p>Showing first 10 of ${matchingStations.length} results. Keep typing to narrow down.</p>` : ''}
                </div>
            `;

                document.querySelectorAll('.station-button').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const stopId = btn.dataset.stopId;
                        await loadStationDepartures(stopId);
                    });
                });

                return;
            }
        }

        sorted.slice(0, 8).forEach(t => {
            const row = document.createElement("div");
            row.className = "train-row";

            row.innerHTML = `
            <span class="train-station">${t.station}</span>
            <span class="train-line" style="color:${LINE_COLOURS[t.destination] || "#000"}">
                ${t.destination}
            </span>
            <span class="train-platform">Platform ${t.platform}</span>
            <span>${t.mins} min</span>
        `;

            board.appendChild(row);
        });
    }

    async function loadStationDepartures(stopId) {
        const board = document.getElementById("train-board");
        board.innerHTML = `Loading departures for ${allStations[stopId]}...`;

        try {
            const res = await fetch(`https://ptv.jontyleslie.workers.dev/?stop=${stopId}`);
            const data = await res.json();

            if (!data.departures || data.departures.length === 0) {
                board.innerHTML = `No upcoming departures for ${allStations[stopId]}.`;
                return;
            }

            board.innerHTML = `<h3>Departures from ${allStations[stopId]}</h3>`;

            data.departures.slice(0, 10).forEach(dep => {
                const time = dep.estimated_departure_utc || dep.scheduled_departure_utc;
                if (!time) return;

                const diff = new Date(time).getTime() - Date.now();
                const mins = Math.ceil(diff / 60000);

                if (!Number.isFinite(mins) || mins < 0) return;

                const route_id = dep.route_id;
                const platform = dep.platform_number;
                const line_name = LINES[route_id] || route_id;
                const direction = data.directions?.[dep.direction_id]?.direction_name || "";

                const row = document.createElement("div");
                row.className = "train-row";

                 let direction_id = dep.direction_id || "";

                if (direction_id == 1) {
                    direction_id = "From ";
                }
                else {
                    direction_id = "To ";
                }


                row.innerHTML = `
                <span class="train-line" style="color:${LINE_COLOURS[line_name] || "#000"}">
                    ${direction_id}${line_name}
                </span>
                <span class="train-station">${direction}</span>
                <span class="train-platform">Platform ${platform}</span>
                <span>${mins} min</span>
            `;

                board.appendChild(row);
            });

            const backBtn = document.createElement("button");
            backBtn.className = "back-button";
            backBtn.textContent = "Back to search";
            backBtn.style.marginTop = "20px";
            backBtn.onclick = () => {
                sortMode = "search";
                renderBoard();
            };
            board.appendChild(backBtn);

        } catch (err) {
            board.innerHTML = `Failed to load departures for ${allStations[stopId]}.`;
            console.error(err);
        }
    }
</script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>



</body>

</html>